<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for Libraries\SignatureLibrary.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">Libraries/</a> SignatureLibrary.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/2</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/14</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: GPL-3.0
&nbsp;
pragma solidity 0.8.7;
&nbsp;
/**
 signature verification common functionality
 */
&nbsp;
library SignatureLibrary{
&nbsp;
    // DATA /////////////////////////////////////////
    bytes32 public constant domainTypeHash = keccak256("EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)");
    bytes32 public constant addCertificateOnBehalfOfTypeHash = keccak256("addCertificateOnBehalfOf(address provider,bytes32 certificateHash,address holder,uint256 nonce,uint256 deadline)");
    bytes32 public constant voteTypeHash = keccak256("voteOnBehalfOf(address voter,uint256 propID,bool vote,uint256 nonce,uint256 deadline)");
    string public constant salt = '\x19\x01';
&nbsp;
&nbsp;
    // ADD CERTIFICATES FUNCTIONALITY /////////////////////////////////////////////////////////////
<span class="fstat-no" title="function not covered" >    function verifyAddCertificate(address provider, bytes32 certificateHash, address holder, uint nonce, uint256 deadline, bytes memory signature, string memory ContractName, string memory ContractVersion) public view returns (bool) </span>
    {
<span class="cstat-no" title="statement not covered" >        bytes32 functionHash = getMessageHashAddCertificate(provider, certificateHash, holder, nonce, deadline);</span>
<span class="cstat-no" title="statement not covered" >        return verify(provider, functionHash, signature, ContractName, ContractVersion);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getMessageHashAddCertificate(address provider, bytes32 certificateHash, address holder, uint nonce, uint256 deadline) public pure returns (bytes32) </span>
    {
<span class="cstat-no" title="statement not covered" >        return keccak256(</span>
                abi.encode(
                    addCertificateOnBehalfOfTypeHash,
                    provider,
                    certificateHash,
                    holder,
                    nonce,
                    deadline
            ));
    }
&nbsp;
    // VOTE FUNCTIONALITY /////////////////////////////////////////////////////////////
<span class="fstat-no" title="function not covered" >    function verifyVote(address voter, uint256 propID, bool vote, uint nonce, uint256 deadline, bytes memory signature, string memory ContractName, string memory ContractVersion) public view returns (bool) </span>
    {
<span class="cstat-no" title="statement not covered" >        bytes32 functionHash = getMessageHashVote(voter, propID, vote, nonce, deadline);</span>
<span class="cstat-no" title="statement not covered" >        return verify(voter, functionHash, signature, ContractName, ContractVersion);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getMessageHashVote(address voter, uint256 propID, bool vote, uint nonce, uint256 deadline) public pure returns (bytes32) </span>
    {
<span class="cstat-no" title="statement not covered" >        return keccak256(</span>
             abi.encode(
                voteTypeHash,
                voter,
                propID,
                vote,
                nonce,
                deadline
            ));
    }
&nbsp;
    // COMMON FUNCTIONALITY /////////////////////////////////////////////////////////////
<span class="fstat-no" title="function not covered" >    function verify(address signer, bytes32 _functionHash, bytes memory signature, string memory ContractName, string memory ContractVersion) internal view returns (bool) </span>
    {
<span class="cstat-no" title="statement not covered" >        bytes32 domainHash = getDomainHash(ContractName, ContractVersion);</span>
<span class="cstat-no" title="statement not covered" >        bytes32 prefixedHash = keccak256(abi.encodePacked(salt, domainHash, _functionHash));</span>
<span class="cstat-no" title="statement not covered" >        return (recoverSigner(prefixedHash, signature) == signer);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getDomainHash(string memory ContractName, string memory ContractVersion) public view returns(bytes32)</span>
    {
<span class="cstat-no" title="statement not covered" >        return keccak256(</span>
            abi.encode(
                domainTypeHash,
                keccak256(bytes(ContractName)),
                keccak256(bytes(ContractVersion)),
                block.chainid,
                address(this)
        ));
      
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function recoverSigner(bytes32 _prefixedHash, bytes memory _signature) public pure returns (address)</span>
    {
<span class="cstat-no" title="statement not covered" >        (bytes32 r, bytes32 s, uint8 v) = splitSignature(_signature);</span>
<span class="cstat-no" title="statement not covered" >        return ecrecover(_prefixedHash, v, r, s);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function splitSignature(bytes memory sig) public pure returns (bytes32 r, bytes32 s, uint8 v)</span>
    {
<span class="cstat-no" title="statement not covered" >        require(sig.length == 65, "invalid signature length")</span>;
        assembly {
            // first 32 bytes, after the length prefix which are 32 bytes long too
            r := mload(add(sig, 32))
            // second 32 bytes
            s := mload(add(sig, 64))
            // final byte (first byte of the next 32 bytes)
            v := byte(0, mload(add(sig, 96)))
        }
        // implicitly return (r, s, v)
    }
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu May 05 2022 13:13:49 GMT+0200 (heure d’été d’Europe centrale)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
